import streamlit as st
import pandas as pd
import plotly.express as px
from datetime import datetime, timedelta

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(
    page_title="è¶‹åŠ¿æ´å¯Ÿ",
    page_icon="ğŸŒ",
    layout="wide"
)

# è‡ªå®šä¹‰CSSæ ·å¼
st.markdown("""
    <style>
    .main {
        background-color: #f5f7f9;
    }
    .title {
        font-size: 32px;
        font-weight: bold;
        color: #1e3d59;
        margin-bottom: 20px;
    }
    .card {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    </style>
    """, unsafe_allow_html=True)

# é¡µé¢æ ‡é¢˜
st.markdown('<p class="title">ğŸŒ è·¨å¢ƒè¶‹åŠ¿åˆ†æ</p>', unsafe_allow_html=True)

# æœç´¢è¶‹åŠ¿åˆ†æ
# è¾“å…¥å…³é”®è¯
keywords = st.text_input("è¾“å…¥å…³é”®è¯ï¼ˆå¤šä¸ªå…³é”®è¯ç”¨é€—å·åˆ†éš”ï¼‰", "è·¨å¢ƒç”µå•†,äºšé©¬é€Š,é€Ÿå–é€š")
keywords_list = [k.strip() for k in keywords.split(",")]

# é€‰æ‹©æ—¶é—´èŒƒå›´
timeframe = st.selectbox(
    "é€‰æ‹©æ—¶é—´èŒƒå›´",
    ["è¿‡å»7å¤©", "è¿‡å»30å¤©", "è¿‡å»90å¤©", "è¿‡å»12ä¸ªæœˆ"]
)

if st.button("åˆ†æè¶‹åŠ¿"):
    # ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
    dates = pd.date_range(
        end=datetime.now(),
        periods={'è¿‡å»7å¤©': 7, 'è¿‡å»30å¤©': 30, 'è¿‡å»90å¤©': 90, 'è¿‡å»12ä¸ªæœˆ': 365}[timeframe],
        freq='D'
    )
    
    data = {}
    for kw in keywords_list:
        # ç”Ÿæˆéšæœºè¶‹åŠ¿æ•°æ®
        import numpy as np
        trend = np.random.normal(loc=50, scale=10, size=len(dates))
        trend = np.abs(trend)  # ç¡®ä¿æ•°å€¼ä¸ºæ­£
        data[kw] = trend
        
    df = pd.DataFrame(data, index=dates)
    
    # åˆ›å»ºä¸¤åˆ—å¸ƒå±€
    col1, col2 = st.columns([2, 1])
    
    with col1:
        # ç»˜åˆ¶è¶‹åŠ¿å›¾
        fig = px.line(df, 
                     title='æœç´¢è¶‹åŠ¿å˜åŒ–',
                     labels={'value': 'æœç´¢çƒ­åº¦', 'date': 'æ—¥æœŸ', 'variable': 'å…³é”®è¯'})
        st.plotly_chart(fig, use_container_width=True)
    
    with col2:
        st.subheader("çƒ­é—¨ç›¸å…³è¯")
        # ä¸ºæ¯ä¸ªå…³é”®è¯ç”Ÿæˆæ¨¡æ‹Ÿçš„ç›¸å…³è¯
        for kw in keywords_list:
            st.write(f"ä¸ '{kw}' ç›¸å…³çš„çƒ­é—¨è¯ï¼š")
            related_words = pd.DataFrame({
                'ç›¸å…³è¯': [f'{kw}ç›¸å…³è¯{i}' for i in range(1, 6)],
                'çƒ­åº¦': np.random.randint(1000, 10000, 5)
            })
            st.dataframe(related_words, hide_index=True)

# æ·»åŠ é¡µè„š
st.markdown("---")
st.markdown(
    "æ³¨ï¼šå½“å‰å±•ç¤ºä¸ºæ¨¡æ‹Ÿæ•°æ® | æ›´æ–°æ—¶é—´: " + 
    datetime.now().strftime("%Y-%m-%d %H:%M:%S")
)
